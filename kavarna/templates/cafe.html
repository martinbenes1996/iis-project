{% extends "subpage.html" %}

{% block header %}{{cafe.name}}{% endblock %}

{% block score %}
<div class="row" style="margin: 20px">
    <div class="col-lg text-center"> 

        <!-- LIKE/STOP LIKING tlacitko -->
        {% if loggeduser %}
        <input type="button" id="like" class="btn btn-lg btn-warning" name="{{ likebutton }}" value=
        {% if is_liking %}
            "Stop Liking"
        {% else %}
            "Like"
        {% endif %}
        />
        <script>
        // click -> sends async request
        $('#like').click(function(){
            $.ajax({
                type: "POST",
                url: "{% url 'cafe' %}",
                data: {'pk': '{{ cafe.pk }}', 
                       'role': 'like',
                       'csrfmiddlewaretoken': '{{ csrf_token }}'},
                dataType: "json",
                // on success changes 
                success: function(response) {
                    $('#like').prop('value', response.likevalue)
                },
                // on error nothing :(
                error: function(rs, e) {
                }
            }); 
        })
        </script>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block tab1title %}Základní informace{% endblock %}
{% block tab2title %}Co nabízíme?{% endblock %}
{% block tab3title %}Děje se u nás{% endblock %}
{% block tab4title %}Vaše názory{% endblock %}

{% block tab1header %}Základní informace{% endblock %}
{% block tab1 %}
<div class="row" style="margin-top: 20px">
        
    <div class="col-lg-4 text-center">
        {{cafe.street}} {{cafe.housenumber}}<br>
        {{cafe.city}}<br>
        PSC: {{cafe.psc}}<br>
        Capacity: {{cafe.capacity}}
    </div>
    <div class="col-lg-4 text-center">
        {{cafe.opensAt}} - {{cafe.closesAt}}
        <form method="get" action="/profile">
            <input name="user" type="hidden" value="{{ cafe.owner.id }}" required />
            Majitel: <button class="btn btn-link" type="Submit">{{cafe.owner.first_name}} {{cafe.owner.last_name}}</button>
        </form>
    </div>
    <div class="col-lg-4 text-center">
        <h3>Hodnocení: {{ cafe_score }}</h3>
        <h3>Ohodnot si sam:</h3>
        {% include 'snippets/scorebar.html' with pk_subject=cafe.pk reactingto="Cafe" %}
    </div>
</div>
<div class="row" style="margin-top: 30px">
    <div class="col text-center">
        <p>{{cafe.description}}</p>
    </div>
</div>
<div class="row text-center" style="margin-top: 20px">
    <div class="col">
        
    </div>
</div>
{% endblock %}

{% block tab2header %}Co nabízíme?{% endblock %}
{% block tab2 %}
<div class="row hcentralize">
    <div class="col">
        <table>
            {% for a in cafe_coffee_list %}
            <tr>
                <th>
		    <form method="get" action="/coffee">
                	<input name="id" type="hidden" value={{a.pk}} required />
                	<button class="btn btn-link" type="Submit">{{a.name}}</button>
            	    </form>
		</th>
		{% if owner == loggeduser %}
                <th>
                    <form method="get" action="{% url 'deletecoffee' %}">{% csrf_token %}
			<input name="pk_cafe" type="hidden" value="{{ cafe.pk }}" required />
                        <input name="pk" type="hidden" value="{{ a.pk }}" required />
			<input name="request_path" type="hidden" value="/profile" required />
                        <button type="Submit">Delete</button>
                    </form>
		</th>
		<th>
		    <form method="get" action="{% url 'modifycoffee' %}">{% csrf_token %}
			<input name="pk" type="hidden" value="{{ cafe.pk }}" required />
                        <input name="coffeeid" type="hidden" value="{{ a.pk }}" required />
			<input name="request_path" type="hidden" value="/profile" required />
                        <button type="Submit">Modify</button>
                    </form>
		</th>
		{% endif %}
             </tr>
             {% endfor %}
         </table>
    </div>
</div>

<br>
{% if owner == loggeduser %}
<div class="row hcentralize">
    <div class="col-lg">
	<div class="row hcentralize">
	    <form method="get" action="{% url 'addcoffee' %}">
               	<input name="cafeid" type="hidden" value={{cafe.pk}} required />
                <button class="btn btn-lg btn-warning" type="Submit">Add coffee</button>
            </form>
	</div>
    </div>

</div>
{% endif %}
{% endblock %}


{% block tab3header %}Děje se u nás{% endblock %}
{% block tab3 %}
<div class="row">
    <div class="col-lg-2"></div>
    <div class="col-lg-8">
        <table>
            {% for a in event_list %}
            <tr>
                <th>
		            <form method="get" action="/event/">
                	    <input name="id" type="hidden" value={{a.pk}} required />
                	    <button class="btn btn-link" type="Submit">{{a.name}}</button>
            	    </form>
                </th>
                <th> {{ a.price }} </th>
                <th> {{ a.capacity }} </th>
                <th>
                    <form method="get" action="/cafe/">
                        <input name="id" type="hidden" value={{a.place.pk}} required />
                        <button class="btn btn-link" type="Submit">{{a.place.name}}</button>
                    </form>
                </th>
                
                {% if owner == loggeduser %}
                <th>
                    <form method="get" action="{% url 'deleteevent' %}">{% csrf_token %}
                        <input name="pk" type="hidden" value="{{ a.pk }}" required />
			            <input name="request_path" type="hidden" value="/profile" required />
                        <button type="Submit">Delete</button>
                    </form>
		        </th><!--
		            <th>
		                <form method="get" action="{% url 'modifycoffee' %}">{% csrf_token %}
			                <input name="pk" type="hidden" value="{{ cafe.pk }}" required />
                            <input name="coffeeid" type="hidden" value="{{ a.pk }}" required />
			                <input name="request_path" type="hidden" value="/profile" required />
                            <button type="Submit">Modify</button>
                        </form>
		            </th>-->
		        {% endif %}
            </tr>
            {% endfor %}
            <span id="append"></span>
            {% if owner == loggeduser %}
            <tr>
                <form id="NewEventCafeForm" data-toggle="validator" role="form"
                    class="form-signin" action="/addevent/" method="post"
                    style="display: inline">{% csrf_token %}
                    <input name="cafeid" type="hidden" value="{{ cafe.pk }}" required />
                    <tr>
                    <th><input type="" class="form-control" name="name" placeholder="Event Name" required></th>
                    <th><input type="" class="form-control" name="price" placeholder="Price"></th>
                    <th><input type="" class="form-control" name="capacity" placeholder="Capacity"></th>
                    <th><button class="btn btn-warning btn-block" type="submit">Add new event</button></th>
                    <th></th>
                    </tr>
                </form>
                <script>
                    $("#NewEventCafeForm").submit(function(e) {
                        var form = $(this);
                        var url = form.attr('action');
                        $.ajax({
                            type: "POST",
                            url: url,
                            data: form.serialize(), // serializes the form's elements.
                            success: function(data) {
                                window.location.reload();
                                //alert('Form OK!');
                                //alert(data); // show response from the php script.
                            },
                            error: function(rs, e) {
                                //alert('Chyba!')
                                //alert(rs);
                            }
                        });
                        e.preventDefault(); // avoid to execute the actual submit of the form.
                    });
                </script>
                {{warning|safe}}
             </tr>
             {% endif %}
         </table>
    </div>
    <div class="col-lg-2"></div>
</div>

{% endblock %}


{% block tab4header %}Vaše názory{% endblock %}
{% block tab4 %}
<div class="row">
    <div class="col hcentralize align-center">
        <ul>
            {% for node in cafe_reactions %}
                {% if not node.react %}
                    {% include "snippets/reaction.html"%}
                {% endif %}
            {% endfor %}
            {% if loggeduser %}
            <form method="POST" action="/react/">{% csrf_token %}
                <input name="cafe_id" type="hidden" value="{{cafe.pk}}" required />
                <div class="row">
                    <div class="col-lg-6"><input name="text" placeholder="React" required /> </div>
                    <div class="col-lg-6"><button class="btn" type="submit">Send</button></div>
                </div>
             </form>
             {% endif %}
        </ul>
    </div>
</div>
{% endblock %}

